<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perbandingan CRS - Sebaran Universitas</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #map1, #map2 {
      height: 400px;
      margin-bottom: 25px;
      border: 2px solid #333;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h2>Peta 1: Web Mercator (EPSG:3857)</h2>
  <div id="map1"></div>

  <h2>Peta 2: Geographic (EPSG:4326)</h2>
  <div id="map2"></div>

  <script>
    // ===== BASEMAPS =====
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20,
      attribution: '&copy; OpenStreetMap contributors'
    });

    const satellite = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
      maxZoom: 20,
      attribution: '&copy; Google Satellite'
    });

    // ===== ICON UNIVERSITAS =====
    const campusIcon = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/2972/2972309.png',
      iconSize: [35, 35]
    });

    // ===== STYLE UNTUK POLYGON & LINE =====
    function styleFeature(feature) {
      if (feature.geometry.type === "Polygon") {
        return {
          color: "blue",
          weight: 2,
          fillColor: "lightblue",
          fillOpacity: 0.3
        };
      }
      if (feature.geometry.type === "LineString") {
        return {
          color: "red",
          weight: 3
        };
      }
    }

    // ====== PETA 1: EPSG:3857 ======
    const map1 = L.map('map1', {
      center: [-6.37, 106.83],
      zoom: 13,
      layers: [osm]
    });

    const markers1 = L.layerGroup();
    const polygons1 = L.layerGroup();
    const polylines1 = L.layerGroup();

    fetch('univ.geojson')
      .then(res => res.json())
      .then(data => {
        // Marker
        data.features.forEach(f => {
          if (f.geometry.type === "Point" && f.properties.nama) {
            const [lon, lat] = f.geometry.coordinates;
            L.marker([lat, lon], { icon: campusIcon })
              .bindPopup(`<b>${f.properties.nama}</b><br>Koordinat: ${lat.toFixed(4)}, ${lon.toFixed(4)}`)
              .addTo(markers1);
          }
        });

        // Polygon & Polyline
        L.geoJSON(data, { style: styleFeature }).eachLayer(layer => {
          if (layer instanceof L.Polygon) polygons1.addLayer(layer);
          if (layer instanceof L.Polyline) polylines1.addLayer(layer);
        });

        markers1.addTo(map1);
        polygons1.addTo(map1);
        polylines1.addTo(map1);
      });

    L.control.layers(
      { "OpenStreetMap": osm, "Satellite": satellite },
      { "Marker Universitas": markers1, "Polygon Area": polygons1, "Polyline Jalur": polylines1 }
    ).addTo(map1);


    // ====== PETA 2: EPSG:4326 ======
    const map2 = L.map('map2', {
      crs: L.CRS.EPSG4326,
      center: [-6.37, 106.83],
      zoom: 13,
      layers: [osm]
    });

    const markers2 = L.layerGroup();
    const polygons2 = L.layerGroup();
    const polylines2 = L.layerGroup();

    fetch('univ.geojson')
      .then(res => res.json())
      .then(data => {
        data.features.forEach(f => {
          if (f.geometry.type === "Point" && f.properties.nama) {
            const [lon, lat] = f.geometry.coordinates;
            L.marker([lat, lon], { icon: campusIcon })
              .bindPopup(`<b>${f.properties.nama}</b><br>Koordinat: ${lat.toFixed(4)}, ${lon.toFixed(4)}`)
              .addTo(markers2);
          }
        });

        L.geoJSON(data, { style: styleFeature }).eachLayer(layer => {
          if (layer instanceof L.Polygon) polygons2.addLayer(layer);
          if (layer instanceof L.Polyline) polylines2.addLayer(layer);
        });

        markers2.addTo(map2);
        polygons2.addTo(map2);
        polylines2.addTo(map2);
      });

    L.control.layers(
      { "OpenStreetMap": osm, "Satellite": satellite },
      { "Marker Universitas": markers2, "Polygon Area": polygons2, "Polyline Jalur": polylines2 }
    ).addTo(map2);
  </script>
</body>
</html>
